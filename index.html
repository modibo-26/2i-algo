<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title></title>
</head>

<body>
    <form>
        <div>
            <label for="name">Name</label>
            <input type="text" name="name" id="name">
        </div>

        <div>
            <label for="portes-2">Nombre de portes
                2: <input type="radio" name="portes" id="portes-2" value="2">
            </label>
            <label for="portes-4">
                4: <input type="radio" name="portes" id="portes-4" value="4">
            </label>
        </div>

        <div>
            <label for="cars">Cars</label>
            <select name="cars" id="cars">

                <!-- Afficher les voitures ici -->
                <!-- Que les voitures soient groupés par marque
                Si je coche le bouton 2, n'affichez que les voitures a 2 portes
                Sinon afficher les autres
                Afficher une option null par avec choisir un vehicule
                Quand l'otion null est selectionne, mettre le bg en rouge -->

            </select>
        </div>

        <div>
            <input type="submit" name="person">
        </div>
    </form>
    <script src="./jquery-3.6.0.js"></script>


    <script>


        const cars = [
            { brand: 'Peugeot', make: '208', portes: 2 },
            { brand: 'Renault', make: 'Clio', portes: 2 },
            { brand: 'Citroên', make: 'c3', portes: 2 },
            { brand: 'Peugeot', make: '2008', portes: 5 },
            { brand: 'Citroên', make: 'c4', portes: 4 },
            { brand: 'Peugeot', make: '308', portes: 4 },
            { brand: 'Peugeot', make: '5008', portes: 5 },
            { brand: 'Citroên', make: '508', portes: 3 },
        ];


        let sortedCars = {};

        cars.forEach(car => {
            if (sortedCars[car.brand] === undefined) {
                sortedCars[car.brand] = [];
            }
            sortedCars[car.brand].push(car);
        });



        Object.keys(sortedCars).forEach(brand => {

            $('select').append(`<optgroup label='${brand}'></optgroup>`);

            sortedCars[brand].forEach(car => {
                $(`optgroup[label=${brand}]`).append(
                    `<option value='${car.make}'>${car.make}</option>`
                )
            });
        });
        
        let getCarsList = function (portes) {
            $('select').prepend(` <option value= "" selected=selected>Selectionner une voiture </option> `)

            let sortedCars = {};

            let filterdCars = cars.filter(car => {
                if (portes === undefined) { return true; }

                if (parseInt(portes) === 2) { return car.portes === 2 }

                return car.portes !== 2;
            });

            filterdCars.forEach(car => {

                if (sortedCars[car.brand] === undefined) {
                    sortedCars[car.brand] = [];
                }
                sortedCars[car.brand].push(car);
            });



            Object.keys(sortedCars).forEach(brand => {

                $('select').append(`<optgroup label='${brand}'></optgroup>`);

                sortedCars[brand].forEach(car => {
                    $(`optgroup[label=${brand}]`).append(
                        `<option value='${car.make}'>${car.make}</option>`
                    )
                });
            });

        }

        let setSelectBackground = function () {
            $('select').css('background', $('select').val() === '' ? 'red' : 'transparent');

        }

        $('input[name=portes]').on('change', function (event) {
            $('select').html('');

            getCarsList($(this).val());
        })

        $('select').on('change', setSelectBackground);

        getCarsList();
        setSelectBackground();

    </script>

</body>

</html>